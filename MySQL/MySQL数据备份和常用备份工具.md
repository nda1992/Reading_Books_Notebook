# MySQL数据备份、恢复和常用备份工具

> 数据备份是DBA日常最重要的工作之一，如何保证数据丢失后能恢复到事故之前，数据的备份是其中重要的一步.
>
> 数据备份不是最终的目的，而数据恢复才是最终的目的.
>
> 在日常的工作中，需要对数据和二进制日志都进行备份
>
> 首先，二进制日志记录了数据库的所有更新操作，如果在数据库崩溃之前没来得及备份，那么可以使用二进制日志对操作更新过的数据进行“重放”名即可恢复到崩溃前的情况.





### 数据备份的注意事项

- 最多能容忍多少数据丢失
- 数据恢复需要多长的时间完成
- 需要恢复的数据有哪些
- 备份时服务器的可以承受的负载
- 定期测试备份的可用性，并提高恢复操作的效率
- 锁定资源的时长



### 备份的类型

- 涉及的数据范围

```
完全备份：整个数据集

部分备份：数据的一个子集，如某些表
```

- 数据的变化

```
完全备份：整个范围都备份

增量备份：仅备份上一次完全备份或增量备份以来变化的那部分数据

差异备份：仅备份上一次完全备份以来的变化的那部分数据
```

- 按操作对象分类

```
物理备份：直接从磁盘复制数据文件进行备份

逻辑备份：从数据库导出数据，另存到一个或多个文件中，将数据转换为具体的SQL语句
```

- 按照服务器备份时的运行状态分类

```
热备：读写操作均可进行的状态下所做的备份

温备：可读但不可写的状态下进行备份

冷备：读写操作均不可进行的状态下所做的备份
```

### 备份的策略

```
（binlogs是MySQL中最重要的日志之一，它记录了所有的DDL和DML语句（除了查询之外）），因此可以考虑将数据与二进制日志分开存放，并对二进制日志也进行备份

全量+差异+binlogs

全量+增量+binlogs
```





### MySQL备份工具

- mysqldump

```
mysql服务自带的备份工具，它是一个逻辑备份工具，本质是将数据库转换为可执行的sql脚本，可用来做完全备份和部分备份，支持InnoDB存储引擎的热备功能，支持MyISAM存储引擎的温备功能。


备份的原理：通过协议连接到MySQL，将需要备份的数据查询出来，将查询出来的数据转换成对应的insert语句，当需要这些数据时，只需要执行这些insert语句即可做到数据的还原.

优点：可以直接使用文本处理工具处理对应的备份数据，因为备份的数据已经被mysqldump转换为了INSERT语句，所以可以借助文件系统中的文本处理工具对备份数据直接进行处理.

缺点：当数据为浮点型时，会出现精度丢失的情况；因为是逻辑备份，所以备份的速度、恢复的速度相对较慢，同时mysqldump是串行化的，不支持并行备份，所以当数据量较大时，导致备份的速率较低，一般不会使用mysqldump进行备份。
```

- mysqldump的备份过程：

  ```mysql
  -- 1、 锁表
  flush tables wirh read lock;
  
  
  -- 2、滚动日志
  flush logs
  
  -- 3、备份(在Linux命令行上执行)
  mysqldump -uroot -p123456 --databases student | gzip > /opt/student.sql.gz
  
  ```

- tar/cp备份

```
系统自带的cp/tar工具：这是一种物理备份，它的原理是基于快照时间，快照请求一个全局锁之后将会立即释放，达到热备的效果，但是不能仅仅备份数据，还要同时备份事务日志，并且要求数据和日志在同一个逻辑卷内
```



### trabackup备份工具

- 组成

```
xtrabackup：由Percona开发的开源备份工具，支持InnoDB热备，是一款物理备份工具，它还支持完全备份、差异备份和增量备份等.

xtrabackup的特点：
能够对InnoDB实现热备，无需暂停数据库
能够对MySQL进行增量备份
对MySQL备份能够实现流式压缩并传输给其他服务器，--stream参数实现
MySQL服务运行时能够在MySQL 服务器之间进行表的迁移
能够很容易创建一个MySQL从服务器
备份MySQL时不会增加服务器负担

两个主要工具：
（1）xtrabackup
只能备份InnoDB和XtraDB两种数据表，不能备份MyISAM的数据表

（2）innobackupex
封装了xtrabackup，同时支持InnoDB和MyISAM（处理MyISAM时需要添加一个读的锁）
```























